<h2>Meet the Pod</h2>
<div id="members" class="card-container">
    <script>
        let fellows = []; // initialize array holding fellows

        // extract github usernames from fellows.yml
        {% for item in site.data.fellows %} 
            fellows.push({
                github: "{{ item.github }}",
                name: "{{ item.name }}",
                location: "{{ item.location }}",
                commits: 0,
                linkedin: "{{ item.linkedin }}",
                twitter: "{{ item.twitter }}",
                resum: "{{ item.resume }}"
            });
        {% endfor %}

        // get data from github
        async function getData(url) {
            const res = await fetch( url );
            const data = res.json();
            return data;
        }

        async function computeScore() {
            const rawCommitdata = await getData("https://api.github.com/repos/MLH-Fellowship/prep-portfolio-22.AUG.PREP.2/stats/contributors");

            let commitData = rawCommitdata.reduce((obj, item) => (obj[item.author.html_url] = item.total, obj) ,{});
            
            for (const fellow of fellows) {
                fellow.commits = (!commitData[fellow.github]) ? 0 : commitData[fellow.github];
            }
            
            const rawClosedIssuesData = await getData("https://api.github.com/repos/MLH-Fellowship/prep-portfolio-22.AUG.PREP.2/issues?state=closed")
            
            
            fellows.sort((a, b) => {
                return (a.commits < b.commits) ? 1 : ((b.commits < a.commits) ? -1 : 0);
            }); // sort fellows based on total commits

            const cardContainer = document.getElementsByClassName('card-container')[0];

            let fellowsHTML = "";
            let lock = 3;

            for (const fellow of fellows) {
                let img = '';

                if (lock && lock--) {
                    img = `<img src="./assets/img/icons/crown${3-lock}.png" class="card-badge" />`;
                }

                let cardHTML = `
                <div class="card">
                    <div class="info">
                        ${img}
                        <a href="/fellows/${fellow.name.replace(/ /g, '-')}">
                            <p class="title"> ${ fellow.name }</p>
                            <p class="location"> ${ fellow.location }</p>
                        <a>
                        <div class="icon">
                            <a ${(!fellow.github) ? "hidden" : ""} href=${fellow.github}>
                                <i class="fab fa-github fa-lg"></i>                    
                            </a>
                            <a ${(!fellow.twitter) ? "hidden" : ""} href=${fellow.twitter}>
                                <i class="fab fa-twitter fa-lg" style="color: #1DA1F2;"></i>                
                            </a>
                            <a ${(!fellow.resume) ? "hidden" : ""} href=${fellow.resume}>
                                <img class="social-link-icon" src="./assets/img/icons/resume.png">
                            </a>
                            <a ${(!fellow.linkedin) ? "hidden" : ""} href=${fellow.linkedin}>
                                <i class="fab fa-linkedin-in fa-lg" style="color: #0A66C2;"></i>
                            </a>
                        </div>
                        <p class="card-score">Commits: ${ fellow.commits }</p>
                    </div>
                </div>
                `
                fellowsHTML += cardHTML;
            }
            cardContainer.innerHTML += fellowsHTML;
        }

        computeScore();
    </script>
</div>